{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- Sidebar - Settings -->
    <div class="col-lg-4">
        <!-- Cookies Upload -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-cookie-bite"></i> Upload Cookies</h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('upload_cookies') }}" method="post" enctype="multipart/form-data">
                    <div class="upload-area" onclick="document.getElementById('cookiesFile').click()">
                        <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                        <h6>Kéo thả file cookies hoặc nhấn để chọn</h6>
                        <p class="text-muted">Hỗ trợ .txt và .json</p>
                        <input type="file" id="cookiesFile" name="cookies_file" accept=".txt,.json" style="display: none;" onchange="updateFileName(this, 'cookiesFileName')">
                    </div>
                    <div id="cookiesFileName" class="mt-2 text-muted"></div>
                    <button type="submit" class="btn btn-primary w-100 mt-3">
                        <i class="fas fa-upload"></i> Upload Cookies
                    </button>
                </form>
                
                <!-- Cookies Status -->
                <div class="mt-3 p-3 bg-light rounded">
                    <h6>Trạng thái Cookies:</h6>
                    {% if app_state.cookies_loaded %}
                        <span class="text-success">
                            <i class="fas fa-check-circle"></i> 
                            Đã kết nối ({{ app_state.cookies_file }})
                        </span>
                    {% else %}
                        <span class="text-danger">
                            <i class="fas fa-times-circle"></i> 
                            Chưa kết nối
                        </span>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Video Settings -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-cogs"></i> Cài đặt Video</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">Kích thước Video</label>
                    <select class="form-select" id="aspectRatio">
                        <option value="16:9">16:9 (Landscape)</option>
                        <option value="9:16">9:16 (Portrait)</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Độ dài Video (giây)</label>
                    <select class="form-select" id="duration">
                        <option value="5">5 giây</option>
                        <option value="6">6 giây</option>
                        <option value="7">7 giây</option>
                        <option value="8">8 giây</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Độ phân giải</label>
                    <select class="form-select" id="resolution">
                        <option value="720p">720p (HD)</option>
                        <option value="1080p" selected>1080p (Full HD)</option>
                        <option value="1440p">1440p (2K)</option>
                        <option value="2160p">2160p (4K)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Prompt Generator -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-magic"></i> Tạo Prompt Tự Động</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label">Mô tả video bạn muốn tạo:</label>
                    <textarea class="form-control" id="userDescription" rows="3" 
                              placeholder="VD: Một người đàn ông đi bộ trên bãi biển lúc hoàng hôn"></textarea>
                </div>
                <button type="button" class="btn btn-success w-100" onclick="generatePrompt()">
                    <i class="fas fa-wand-magic-sparkles"></i> Tạo Prompt VEO3
                </button>
                
                <div id="generatedPrompt" class="mt-3" style="display: none;">
                    <label class="form-label">Prompt đã tối ưu:</label>
                    <textarea class="form-control" id="optimizedPrompt" rows="4" readonly></textarea>
                    <button type="button" class="btn btn-outline-primary btn-sm mt-2" onclick="copyPrompt()">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="col-lg-8">
        <!-- Prompts Upload -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-file-text"></i> Upload File Prompts</h5>
            </div>
            <div class="card-body">
                <div class="upload-area" onclick="document.getElementById('promptsFile').click()">
                    <i class="fas fa-file-upload fa-3x text-muted mb-3"></i>
                    <h6>Kéo thả file prompts hoặc nhấn để chọn</h6>
                    <p class="text-muted">File .txt với mỗi dòng là một prompt</p>
                    <input type="file" id="promptsFile" accept=".txt" style="display: none;" onchange="uploadPrompts(this)">
                </div>
                <div id="promptsFileName" class="mt-2 text-muted"></div>
                
                <!-- Prompts Preview -->
                <div id="promptsPreview" class="mt-3" style="display: none;">
                    <h6>Preview Prompts:</h6>
                    <div id="promptsList" class="bg-light p-3 rounded" style="max-height: 200px; overflow-y: auto;"></div>
                    <div class="mt-3">
                        <button type="button" class="btn btn-primary btn-lg" onclick="startGeneration()" 
                                {% if not app_state.cookies_loaded %}disabled{% endif %}>
                            <i class="fas fa-play"></i> Bắt đầu tạo Video
                        </button>
                        {% if not app_state.cookies_loaded %}
                            <div class="text-muted mt-2">
                                <i class="fas fa-exclamation-triangle"></i> 
                                Vui lòng upload cookies trước
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Generation Progress -->
        <div class="card mb-4 progress-container" id="progressContainer">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-tasks"></i> Tiến trình tạo Video</h5>
            </div>
            <div class="card-body">
                <div class="progress mb-3">
                    <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%"></div>
                </div>
                <div id="progressStatus">Đang chuẩn bị...</div>
                <div id="currentPrompt" class="text-muted mt-2"></div>
            </div>
        </div>

        <!-- Generated Videos -->
        <div class="card" id="videosContainer" style="display: none;">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-video"></i> Videos đã tạo</h5>
            </div>
            <div class="card-body">
                <div id="videosList"></div>
                <button type="button" class="btn btn-success" onclick="downloadAllVideos()">
                    <i class="fas fa-download"></i> Tải tất cả Videos
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center py-5">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h5 id="loadingMessage">Đang xử lý...</h5>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Page-specific initialization
document.addEventListener('DOMContentLoaded', function() {
    console.log('Gemini VEO3 Generator page loaded');
    
    // All functionality is handled by app.js
    // This script just handles page-specific initialization
});
</script>
{% endblock %}